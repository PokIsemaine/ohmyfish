# 第7章 数据库设计

## 7.1  数据库设计概述

数据库设计
数据库设计是指对于一个给定的应用环境，构造（设计）优化的数据库逻辑模式和物理结构，并据此建立数据库及其应用系统，使之能够有效地存储和管理数据，满足各种用户的应用需求，包括信息管理要求和数据操作要求。

* 信息管理要求：在数据库中应该存储和管理哪些数据对象 。
* 数据操作要求：对数据对象需要进行哪些操作，如查询、增、删、改、统计等操作



数据库设计的目标：为用户和各种应用系统提供一个**信息基础设施和高效率的运行环境 。**

* 数据库数据的存取效率高
* 数据库存储空间的利用率高
* 数据库系统运行管理的效率高

### 7.1.1 数据库设计的特点

* 数据库建设的基本规律：三分技术，七分管理，十二分基础数据
* 结构（数据）设计和行为（处理）设计相结合 

### 7.1.2 数据库设计方法

大型数据库设计是涉及多学科的综合性技术，又是一项庞大的工程项目，它要求多方面的知识和技术



手工试凑法

* 设计质量与设计人员的经验和水平有直接关系
* 缺乏科学理论和工程方法的支持，工程的质量难以保证
* 数据库运行一段时间后常常又不同程度地发现各种问题，增加了维护代价

规范设计法（新奥尔良、ER、3NF、面向对象、UML）

* 基本思想：过程迭代和逐步求精



### 7.1.3 数据库设计的基本步骤

不断反复，设计和处理结合

1. 需求分析：决定了构建数据库的速度和质量
2. 概念结构设计：通过对用户需求进行综合、归纳与抽象，形成一个独立于具体数据库管理系统的概念模型
3. 逻辑结构设计：将概念结构转换为某个数据库管理系统所支持的数据模型，并对其进行优化
4. 物理结构设计：为逻辑数据结构选取一个最适合应用环境的物理结构，包括存储结构和存取方法
5. 数据库实施：根据逻辑设计和物理设计的结果构建数据库，编写与调试应用程序，组织数据入库并进行试运行
6. 数据库运行和维护 ：经过试运行后即可投入正式运行，在运行过程中必须不断对其进行评估、调整与修改



* **需求分析和概念设计独立于任何数据库管理系统** 
* **逻辑设计和物理设计与选用的数据库管理系统密切相关**





​                       

设计人员

* 系统分析人员和数据库设计人员：自始至终参与数据库设计，其水平决定了数据库系统的质量
* 数据库管理员和用户代表，需求分析和数据库的运行和维护
* 应用开发人员：在实施阶段参与进来，分别负责编制程序和准备软硬件环境



![image-20220617200359086](https://s2.loli.net/2022/06/17/NuvPlrUBLzM8ySt.png)

### 7.1.4 数据库设计过程中的各级模式

![image-20220617201112146](https://s2.loli.net/2022/06/17/ADOVeU8m5MPqJcB.png)



## 7.2 需求分析

### 7.2.1 需求分析的任务

需求分析就是分析用户的要求，是设计数据库的起点



* 详细调查现实世界要处理的对象
* 充分了解原系统工作概况
* 明确用户的各种需求
* 在此基础上确定新系统的功能
* 新系统必须充分考虑今后可能的扩充和改变



调查的重点是“数据”和“处理”，获得用户对数据库的要求

* 信息要求：存储哪些数据，数据有什么要求和特点
* 处理要求：用户要完成的处理功能，对处理性能的要求
* 安全性与完整性要求



确定用户需求很难，需要不断交流

### 7.2.2 需求分析的方法

调查清楚用户的实际需求并进行初步分析
与用户达成共识
分析与表达这些需求



调查用户需求的步骤

1. 调查组织机构情况
2. 调查各部门的业务活动情况
3. 协助用户明确对新系统的各种要求，包括信息要求、处理要求、完全性与完整性要求
4. 确定新系统的边界



常用调查方法

* 跟班作业
* 开调查会
* 请专人介绍
* 询问
* 设计调查表请用户填写
* 查阅记录



进一步分析和表达用户需求

分析方法：结构化分析方法

* SA方法从最上层的系统组织机构入手
* 采用自顶向下、逐层分解的方式分析系统

对用户需求进行分析与表达后，需求分析报告必须提交给用户，征得用户的认可



结构化分析的方法：抽象系统，逐步分解

* 数据流：用标有名字的箭头表示有流向的数据
* 数据处理:用标有名字的圈圈表示对数据进行加工或交换
* 数据存储：以类似书本的符号表示对数据文件进行读取或写入处理，可以用指向或离开的箭头表示。
* 数据来源及终点：用命名的正方形表示，表明数据的来源或去向。

### 7.2.3 数据字典

* 数据字典是关于数据库中数据的描述，即元数据，不是数据本身
* 数据字典在需求分析阶段建立，在数据库设计过程中不断修改、充实、完善
* 数据字典是进行详细的数据收集和数据分析所获得的主要结果

**注意：和关系数据库管理系统中数据字典的区别和联系**



数据字典的内容

* 数据项：最小组成单位，不可再分

* 数据结构：由若干个数据项和数据结构组成

* 数据流：数据结构在系统内传输的路径

* 数据存储：数据存储是数据结构停留或保存的地方，也是数据流的来源和去向之一

* 处理过程：处理过程的具体处理逻辑一般用判定表或判定树来描述。数据字典中只需要描述处理过程的说明性信息

	

## 7.3 概念结构设计

将需求分析得到的用户需求抽象为信息结构（即概念模型）的过程就是概念结构设计

概念模型的特点

* 能真实、充分地反映现实世界，是现实世界的一个真实模型。
* 易于理解，从而可以用它和不熟悉计算机的用户交换意见。
* 易于更改，当应用环境和应用要求改变时，容易对概念模型修改和扩充。
* 易于向关系、网状、层次等各种数据模型转换

描述概念模型的工具：E-R模型



ER模型

扩展ER模型

* 参加约束：实体的参与度
* 弱实体是依赖于其它实体存在而存在的实体
	* 不能独立存在，强实体集与弱实体集之间必须是一对多联系，弱实体必须是全部参与
	* 弱实体不一定有自己的码，所有者实体的码+弱实体的某一属性=标识一个弱实体
* 类层次：超类/子类联系称之为ISA联系，ISA联系可以从两个方面来看
	* 可以看作是一个特化，即子类是经过超类特化而得到的
		* 特化是自顶向下的设计过程：对初始实体集求精，产生一系列不同层次的实体子集，在此过程中，实体间的区别被明显地表达出来。
	* 可以看作是一个概括，即超类是对子类进行概括而得到的
		* 概括是自底向上的设计过程，根据实体间共同具有的特征，将多个实体集综合成一个较高层次的实体集。实体集间存在的共性通过概括来表达

### 7.3.5 概念结构设计

**实体与属性的划分原则**
为了简化E-R图的处置，现实世界的事物能作为属性对待的，尽量作为属性对待。
两条准则：

* 作为属性，不能再具有需要描述的性质。属性必须是不可分的数据项，不能包含其他属性。
* 属性不能与其他实体具有联系，即E-R图中所表示的联系是实体之间的联系。



**E-R图的集成**
E-R图的集成一般需要分两步

1. 合并，解决各分E-R图之间的冲突，将分E-R图合并起来生成初步E-R图。
2. 修改和重构。消除不必要的冗余， 生成基本E-R图。



合并E-R图，生成初步E-R图

子系统E-R图之间的冲突主要有三类：

* 属性冲突：属性域冲突，属性取值单位冲突。
* 命名冲突：同名异义，异名同义，命名冲突（命名冲突可能发生在实体、联系、属性上）
* 结构冲突：
	* 同一对象在不同应用中具有不同的抽象，解决方法：把属性变换为实体或把实体变换为属性，使同一对象具有相同的抽象。
	* 同一实体在不同子系统的E-R图中所包含的属性个数和属性排列次序不完全相同，解决方法：使该实体的属性取各子系统的E-R图中属性的并集，再适当调整属性的次序。



消除不必要的冗余，设计基本E-R图

* 所谓冗余的数据是指可由基本数据导出的数据，冗余的联系是指可由其他联系导出的联系。
* 消除冗余主要采用分析方法，即以数据字典和数据流图为依据，根据数据字典中关于数据项之间逻辑关系的说明来消除冗余。

## 7.4 逻辑结构设计

逻辑结构设计的任务：把概念结构设计阶段设计好的基本E-R图转换为与选用数据库管理系统产品所支持的数据模型相符合的逻辑结构



### 7.4.1 E-R向关系模型的转换

转换原则：一个实体型转为一个关系模式



实体型间联系的多种情况

1：1 联系

* 可以转为一个独立的关系模式，每个实体的码均是关系的候选码
* 也可以转为任意一端对应的关系模式合并，合并后关系的码不变

1：n 联系

* 可以转为一个独立的关系模式，关系的码是n端实体的码
* 也可以与n端对应的关系模式合并，合并后关系的码不变，可以减少系统中的关系个数

m：n 联系

* 转换为一个关系模式
* 关系的码是各实体码的组合



### 7.4.2 数据模型的优化

一般的数据模型还需要向特定数据库管理系统规定的模型进行转换。

转换的主要依据是所选用的数据库管理系统的功能及限制。没有通用规则。

对于关系模型来说，这种转换通常都比较简单。

一般的数据模型还需要向特定数据库管理系统规定的模型进行转换。

转换的主要依据是所选用的数据库管理系统的功能及限制。没有通用规则。

对于关系模型来说，这种转换通常都比较简单。



优化数据模型的方法

1. 确定数据依赖。
2. 对于各个关系模式之间的数据依赖进行极小化处理，消除冗余的联系。
3. 按照数据依赖的理论对关系模式进行分析，考察是否存在部分函数依赖、传递函数依赖、多值依赖等，确定各关系模式分别属于第几范式。
4. 按照需求分析阶段得到的各种应用对数据处理的要求，分析对于这样的应用环境这些模式是否合适，确定是否要对它们进行合并或分解
5. 对关系模式进行必要分解，提高数据操作效率和存储空间的利用率
	* 水平分解：把(基本)关系的元组分为若干子集合，定义每个子集合为一个子关系，以提高系统的效率
	* 垂直分解：把关系模式R的属性分解为若干子集合，形成若干子关系模式
		* 原则经常在一起使用的属性从R中分解出来形成一个子关系模式
		* 优点：可以提高某些事务的效率
		* 缺点：可能使另一些事务不得不执行连接操作，降低了效率
		* 适用范围：取决于分解后R上的所有事务的总效率是否得到了提高





并不是规范化程度越高的关系就越优，连接代价可能很高

非BCNF的关系模式虽然会存在不同程度的更新异常，但如果在实际应用中对此关系模式只是查询，并不执行更新操作，就不会产生实际影响。
对于一个具体应用来说，到底规范化进行到什么程度，需要权衡响应时间和潜在问题两者的利弊才能决定





### 7.4.3 设计用户子模式

定义数据库模式主要是从系统的时间效率、空间效率、易维护等角度出发。
定义用户外模式时应该更注重考虑用户的习惯与方便。包括三个方面：

* 使用更符合用户习惯的别名

* 针对不同级别的用户定义不同的视图，以保证系统的安全性
* 简化用户对系统的使用



## 7.5 物理结构设计

什么是数据库的物理设计
数据库在物理设备上的存储结构与存取方法称为数据库的物理结构，它依赖于选定的数据库管理系统。
为一个给定的逻辑数据模型选取一个最适合应用要求的物理结构的过程，就是数据库的物理设计。



数据库物理设计的步骤

1. 确定数据库的物理结构：在关系数据库中主要指存取方法和存储结构;
2. 对物理结构进行评价：评价的重点是时间和空间效率
3. 若 评价结果满足原设计要求，则可进入到物理实施阶段。否则，就需要重新设计或修改物理结构，有时甚至要返回逻辑设计阶段修改数据模型。



### 7.5.1 数据库物理设计的内容和方法



### 7.5.2 关系模式存取方法选择

数据库管理系统常用存取方法
1. B+树索引存取方法
2. Hash索引存取方法
3. 聚簇存取方法

## 7.6 数据库的实施和维护



## 7.7 小结